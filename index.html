<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ShimulModZ ‚Äî Pro URL Shortener</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1: #f6f9ff; --card: #ffffff; --accent1: #5b6cff; --accent2: #7ce6b8; --muted:#6b7280;
    }
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Arial;margin:0;background:linear-gradient(180deg,var(--bg1),#eef6f9);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .wrap{width:100%;max-width:920px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:24px}
    .card{background:var(--card);border-radius:14px;padding:20px;box-shadow:0 8px 30px rgba(20,20,45,0.06)}
    h1{margin:0;font-size:20px}

    /* Form */
    .form .row{display:flex;gap:12px;margin-top:12px}
    .form input[type=text], .form input[type=url], .form button{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(20,20,45,0.06);font-size:14px}
    .form .small{font-size:12px;color:var(--muted);margin-top:8px}
    .actions{display:flex;gap:10px;margin-top:12px}
    .btn{background:linear-gradient(90deg,var(--accent1),#9b8bff);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(20,20,45,0.06);color:var(--muted)}

    /* Result */
    .result{margin-top:14px;padding:12px;border-radius:10px;background:#f8fafc;border:1px solid rgba(20,20,45,0.03)}
    .short{font-weight:600;color:var(--accent1);word-break:break-all}
    .mini{font-size:13px;color:var(--muted)}

    /* History */
    .history-list{display:flex;flex-direction:column;gap:8px}
    .history-item{display:flex;justify-content:space-between;gap:8px;padding:10px;border-radius:10px;border:1px dashed rgba(20,20,45,0.03)}

    /* QR canvas area */
    #qcanvas{display:block;margin-top:10px}

    /* Responsive */
    @media (max-width:920px){.grid{grid-template-columns:1fr;}.card{margin-bottom:12px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="grid">
      <div class="card form">
        <h1>üîó ShimulModZ ‚Äî Pro URL Shortener</h1>
        <p class="small">‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶æ‡¶ì, ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶ï‡ßã‡¶° ‡¶¶‡¶æ‡¶ì (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï), QR ‡¶¨‡¶æ‡¶®‡¶æ‡¶ì ‡¶ì ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßã‡•§</p>

        <div class="row" style="margin-top:14px">
          <input id="url" type="url" placeholder="Enter full URL (https://...)" />
        </div>
        <div class="row">
          <input id="code" type="text" placeholder="Custom code (optional) - ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞/‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ/ -_ allowed" />
        </div>

        <div class="actions">
          <button class="btn" id="shortBtn">Shorten</button>
          <button class="btn ghost" id="clearBtn">Clear</button>
        </div>

        <div id="feedback" class="result" style="display:none">
          <div>Result: <span id="shortLink" class="short"></span></div>
          <div class="mini" id="metaInfo"></div>
          <div style="margin-top:8px">
            <button class="btn ghost" id="copyBtn">Copy</button>
            <button class="btn ghost" id="openBtn">Open</button>
            <button class="btn ghost" id="downloadQrBtn">Download QR</button>
          </div>
          <canvas id="qcanvas"></canvas>
        </div>

      </div>

      <div class="card">
        <h2 style="margin:0;font-size:16px">History & Tools</h2>
        <p class="small">‡¶è‡¶á ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ 10 ‡¶ü‡¶ø ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§</p>

        <div style="margin-top:10px">
          <div style="display:flex;gap:8px;margin-bottom:8px">
            <button class="btn ghost" id="showHistory">Show History</button>
            <button class="btn ghost" id="clearHistory">Clear History</button>
          </div>

          <div id="history" class="history-list"></div>
        </div>

        <hr style="margin:12px 0">
        <div>
          <h3 style="margin:0;font-size:14px">Quick tools</h3>
          <p class="mini">Enter a short code to see clicks (from KV) ‚Äî ‡¶Ø‡¶¶‡¶ø Worker ‡¶è info endpoint ‡¶ö‡¶≤‡ßá‡•§</p>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="inspectCode" type="text" placeholder="short code (e.g. ab12x)" />
            <button class="btn ghost" id="inspectBtn">Inspect</button>
          </div>
          <div id="inspectResult" class="mini" style="margin-top:8px"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
    // ====== CONFIG ======
    const WORKER_URL = 'https://url-short-demo.shimul-modz.workers.dev'; // <-- change to your worker URL

    // ====== UI refs ======
    const urlInput = document.getElementById('url');
    const codeInput = document.getElementById('code');
    const shortBtn = document.getElementById('shortBtn');
    const clearBtn = document.getElementById('clearBtn');
    const feedback = document.getElementById('feedback');
    const shortLinkEl = document.getElementById('shortLink');
    const metaInfo = document.getElementById('metaInfo');
    const copyBtn = document.getElementById('copyBtn');
    const openBtn = document.getElementById('openBtn');
    const downloadQrBtn = document.getElementById('downloadQrBtn');
    const qcanvas = document.getElementById('qcanvas');

    const historyEl = document.getElementById('history');
    const showHistoryBtn = document.getElementById('showHistory');
    const clearHistoryBtn = document.getElementById('clearHistory');

    const inspectCode = document.getElementById('inspectCode');
    const inspectBtn = document.getElementById('inspectBtn');
    const inspectResult = document.getElementById('inspectResult');

    // ====== Helpers ======
    function toast(txt){alert(txt)}

    function saveHistory(item){
      try{
        const arr = JSON.parse(localStorage.getItem('shimul_history')||'[]');
        arr.unshift(item);
        const uniq = [];
        const out = [];
        for(const it of arr){ if(uniq.indexOf(it.code)===-1){ uniq.push(it.code); out.push(it); } }
        while(out.length>10) out.pop();
        localStorage.setItem('shimul_history', JSON.stringify(out));
      }catch(e){console.warn(e)}
    }

    function renderHistory(){
      const arr = JSON.parse(localStorage.getItem('shimul_history')||'[]');
      historyEl.innerHTML='';
      if(!arr.length){ historyEl.innerHTML='<div class="mini">No history yet</div>'; return; }
      arr.forEach(item=>{
        const el = document.createElement('div'); el.className='history-item';
        el.innerHTML = `<div style="flex:1"><div style="font-weight:600">${item.short}</div><div class="mini">${item.long}</div></div>
                        <div style="display:flex;flex-direction:column;gap:6px">
                          <button class="btn ghost" data-copy="${item.short}">Copy</button>
                          <button class="btn ghost" data-open="${item.short}">Open</button>
                        </div>`;
        historyEl.appendChild(el);
      });
    }

    document.addEventListener('click', (e)=>{
      if(e.target && e.target.dataset && e.target.dataset.copy){ navigator.clipboard.writeText(e.target.dataset.copy).then(()=>toast('Copied')) }
      if(e.target && e.target.dataset && e.target.dataset.open){ window.open(e.target.dataset.open, '_blank') }
    });

    // ====== Shorten flow ======
    shortBtn.addEventListener('click', async ()=>{
      const longUrl = urlInput.value.trim();
      let code = codeInput.value.trim();
      if(!longUrl || !/^https?:\/\//i.test(longUrl)){ toast('Please enter a valid URL (start with http/https)'); return; }

      shortBtn.disabled = true; shortBtn.textContent='Working...';
      try{
        const resp = await fetch(WORKER_URL + '/shorten', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ url: longUrl, code }) });
        const data = await resp.json();
        if(data.error){ toast(data.error); return; }

        const item = { short: data.short, long: longUrl, code: data.code, created: Date.now() };
        saveHistory(item); renderHistory();

        feedback.style.display = 'block';
        shortLinkEl.textContent = data.short; metaInfo.textContent = `Code: ${data.code} ‚Ä¢ Created: ${new Date().toLocaleString()}`;

        // generate qr to canvas
        qcanvas.width = 240; qcanvas.height = 240;
        QRCode.toCanvas(qcanvas, data.short, { width: 240 }, function (err) { if(err) console.error(err); });

      }catch(err){ console.error(err); toast('Failed to connect to server.'); }
      finally{ shortBtn.disabled=false; shortBtn.textContent='Shorten' }
    });

    clearBtn.addEventListener('click', ()=>{ urlInput.value=''; codeInput.value=''; feedback.style.display='none' });

    copyBtn.addEventListener('click', ()=>{ const txt = shortLinkEl.textContent; if(txt){ navigator.clipboard.writeText(txt); toast('Short link copied') } });
    openBtn.addEventListener('click', ()=>{ const txt = shortLinkEl.textContent; if(txt) window.open(txt, '_blank') });

    downloadQrBtn.addEventListener('click', ()=>{
      if(!qcanvas) return; const url = qcanvas.toDataURL('image/png'); const a = document.createElement('a'); a.href = url; a.download = 'shortlink-qr.png'; a.click();
    });

    // ====== History UI ======
    showHistoryBtn.addEventListener('click', ()=>{ renderHistory() });
    clearHistoryBtn.addEventListener('click', ()=>{ localStorage.removeItem('shimul_history'); renderHistory(); toast('History cleared') });

    // ====== Inspect code ======
    inspectBtn.addEventListener('click', async ()=>{
      const c = inspectCode.value.trim(); if(!c){ inspectResult.textContent='Enter a code'; return; }
      try{
        const r = await fetch(WORKER_URL + '/info/' + encodeURIComponent(c));
        if(r.status===404){ inspectResult.textContent='Not found'; return; }
        const j = await r.json(); inspectResult.textContent = `Clicks: ${j.clicks || 0} ‚Ä¢ URL: ${j.url}`;
      }catch(e){ inspectResult.textContent='Failed to fetch'; }
    });

    // initial render
    renderHistory();
  </script>
</body>
</html>
